# Custom nginx.conf generated by Ansible

worker_processes auto;  # NGINX will automatically determine the number of worker processes based on the number of CPU cores
events {
    worker_connections 1024;  # The maximum number of simultaneous connections that each worker can handle
}

http {
    # Include additional MIME types for proper content handling
    include       mime.types;  # This file maps file extensions to content types
    default_type  application/octet-stream;  # Default content type for files that are not explicitly defined

    # Server block defining a website
    server {
        listen 80 default_server;  # Listen on port 80 for HTTP requests. "default_server" makes this the default server
        server_name _;  # The underscore (_) is a catch-all. It works as a default for any undefined domain name

        root /var/www/html;  # Define the document root (where static files are served from)
        index index.html;  # Default file to serve when accessing a directory (index.html)

        # Location block that processes requests
        location / {
            try_files $uri $uri/ =404;  # Try to serve the requested file or directory. If not found, return a 404 error
        }

        # Custom log format and access logs
        access_log /var/log/nginx/access.log;  # Logs incoming requests to a file
        error_log /var/log/nginx/error.log;  # Logs errors to a file

        # Additional Configuration (Security & Performance Enhancements)

        # Prevent access to sensitive files (e.g., .htaccess or .git directories)
        location ~ /\.(ht|git) {
            deny all;  # Deny all access to hidden files starting with a dot
        }

        # Define caching for static assets (e.g., images, CSS, JS)
        location ~* \.(jpg|jpeg|png|gif|css|js|woff|woff2|ttf|svg)$ {
            expires 30d;  # Cache these files for 30 days
            add_header Cache-Control "public, must-revalidate";  # Add cache headers for better performance
        }

        # Example of enabling gzip compression to improve load times
        gzip on;  # Enable gzip compression
        gzip_min_length 1000;  # Only compress files larger than 1 KB
        gzip_types text/plain text/css application/javascript application/json application/xml text/javascript;  # Specify content types to compress

        # Handling 404 errors with a custom page
        error_page 404 /404.html;  # Define a custom error page for 404 Not Found
        location = /404.html {
            root /var/www/html;  # Serve the 404.html page from the document root
            internal;  # Make the location accessible only internally
        }

        # Handling 500 errors with a custom page
        error_page 500 502 503 504 /50x.html;  # Define custom error pages for server errors
        location = /50x.html {
            root /var/www/html;
            internal;
        }
    }
}
